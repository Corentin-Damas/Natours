{"mappings":"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","sources":["public/js/index.js","public/js/login.js","public/js/alerts.js","public/js/mapBox.js","public/js/updateSettings.js","public/js/stripe.js"],"sourcesContent":["// import \"@babel/polyfill\";\nimport { login, logout } from \"./login\";\nimport { displayMap } from \"./mapBox\";\nimport { updateSettings } from \"./updateSettings\";\nimport { bookTour } from \"./stripe\";\n\nconst mapBox = document.getElementById(\"map\");\nconst loginForm = document.querySelector(\".form--login\");\nconst logOutBtn = document.querySelector(\".nav__el--logout\");\nconst userDataForm = document.querySelector(\".form-user-data\");\nconst userPasswordForm = document.querySelector(\".form-user-password\");\nconst bookBtn = document.getElementById(\"book-tour\");\n\nconst bookingTourSelected = document.querySelector(\".booking-selection\");\nconst bookingLink = document.querySelector(\".go-to-booking\");\n\nif (mapBox) {\n  const locations = JSON.parse(mapBox.dataset.locations);\n  displayMap(locations);\n}\n\nif (loginForm) {\n  loginForm.addEventListener(\"submit\", (e) => {\n    e.preventDefault();\n    const email = document.getElementById(\"email\").value;\n    const password = document.getElementById(\"password\").value;\n    login(email, password);\n  });\n}\n\nif (logOutBtn) logOutBtn.addEventListener(\"click\", logout);\n\nif (userDataForm)\n  userDataForm.addEventListener(\"submit\", (e) => {\n    e.preventDefault();\n    const form = new FormData();\n    form.append(\"name\", document.getElementById(\"name\").value);\n    form.append(\"email\", document.getElementById(\"email\").value);\n    form.append(\"photo\", document.getElementById(\"photo\").files[0]);\n\n    updateSettings(form, \"data\");\n  });\n\nif (userPasswordForm)\n  userPasswordForm.addEventListener(\"submit\", async (e) => {\n    e.preventDefault();\n    document.querySelector(\".btn--save-password\").textContent = \"Updating\";\n\n    const passwordCurrent = document.getElementById(\"password-current\").value;\n    const password = document.getElementById(\"password\").value;\n    const passwordConfirm = document.getElementById(\"password-confirm\").value;\n    await updateSettings(\n      { passwordCurrent, password, passwordConfirm },\n      \"password\"\n    );\n    document.querySelector(\".btn--save-password\").textContent = \"Save password\";\n    document.getElementById(\"password-current\").value = \"\";\n    document.getElementById(\"password\").value = \"\";\n    document.getElementById(\"password-confirm\").value = \"\";\n  });\n\nif (bookBtn) {\n  bookBtn.addEventListener(\"click\", (e) => {\n    e.target.textContent = \"Processing...\";\n    const { tourId } = e.target.dataset;\n    bookTour(tourId);\n  });\n}\n\nif (bookingTourSelected) {\n  const preSelection = bookingTourSelected.dataset.tourid;\n  bookingTourSelected.addEventListener(\"click\", (e) => {\n    e.preventDefault;\n    bookingLink.href = `http://127.0.0.1:3000/tour/${preSelection}`;\n  });\n}\n","import { showAlert } from \"./alerts\";\r\n\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const res = await axios({\r\n      method: \"POST\",\r\n      withCredentials: true, // Include credentials (cookies)\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      url: \"http://127.0.0.1:3000/api/v1/users/login\",\r\n      data: {\r\n        email,\r\n        password,\r\n      },\r\n    });\r\n\r\n    if (res.status === 200) {\r\n      showAlert(\"success\", \"Logged in successfully\");\r\n      window.setTimeout(() => {\r\n        location.assign(\"/overview\");\r\n      }, 1500);\r\n    }\r\n  } catch (err) {\r\n    showAlert(\"error\", err.response.data.message);\r\n  }\r\n};\r\n\r\nexport const logout = async () => {\r\n  try {\r\n    const res = await axios({\r\n      method: \"GET\",\r\n      // withCredentials: true, // Include credentials (cookies)\r\n      // headers: {\r\n      //   \"Content-Type\": \"application/json\",\r\n      // },\r\n      url: \"http://127.0.0.1:3000/api/v1/users/logout\",\r\n    });\r\n    if (res.status === 200) location.reload(true);\r\n  } catch (err) {\r\n    showAlert(\"error\", \"Error logging out ! Try again\");\r\n  }\r\n};\r\n","export const hideAlert = () => {\r\n  const el = document.querySelector(\".alert\");\r\n  if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\nexport const showAlert = (type, msg) => {\r\n  hideAlert();\r\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\r\n  document.querySelector(\"body\").insertAdjacentHTML(\"afterbegin\", markup);\r\n  window.setTimeout(hideAlert, 5000);\r\n};\r\n","// Client side rendering\r\nexport const displayMap = (locations) => {\r\n  var map = L.map(\"map\").setView(\r\n    switchCoordinates(locations[0].coordinates),\r\n    6\r\n  );\r\n  var myIcon = L.icon({\r\n    iconUrl: \"../img/pin.png\",\r\n    iconSize: [31, 40],\r\n  });\r\n\r\n  L.tileLayer(\"https://tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n    attribution:\r\n      '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n  }).addTo(map);\r\n\r\n  locations.forEach((loc) => {\r\n    L.marker(switchCoordinates(loc.coordinates), { icon: myIcon })\r\n      .addTo(map)\r\n      .bindPopup(`<div class='custom-popup'>${loc.description}</div>`)\r\n      .openPopup();\r\n  });\r\n\r\n  map.removeControl(map.zoomControl);\r\n  L.control\r\n    .zoom({\r\n      position: \"bottomleft\",\r\n    })\r\n    .addTo(map);\r\n\r\n  function switchCoordinates(arr) {\r\n    return [arr[1], arr[0]];\r\n  }\r\n};\r\n","import { showAlert } from \"./alerts\";\r\n\r\nexport const updateSettings = async (data, type) => {\r\n  try {\r\n    const url =\r\n      type == \"password\"\r\n        ? \"http://127.0.0.1:3000/api/v1/users/updateMyPassword\"\r\n        : \"http://127.0.0.1:3000/api/v1/users/updateMe\";\r\n    const res = await axios({\r\n      method: \"PATCH\",\r\n      withCredentials: true, // Include credentials (cookies)\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      url,\r\n      data,\r\n    });\r\n    if (res.data.status === \"success\") {\r\n      showAlert(\"success\", `${type.toUpperCase()} updated successfully ! `);\r\n    }\r\n  } catch (err) {\r\n    showAlert(\"error\", err.response.data.message);\r\n  }\r\n};\r\n","import { showAlert } from \"./alerts\";\r\nconst stripe = Stripe(\r\n  \"pk_test_51PciSXDPLnxXe12TOZlaUOf7S7DCVxkxI9WMXiGuf4xj6kACY4dhPVqIvE68iZxChKETUoo5QEP85MNqeAcq6rAW00Y3BvZt8t\"\r\n);\r\n\r\nexport const bookTour = async (tourId) => {\r\n  try {\r\n    const session = await axios(\r\n      `http://127.0.0.1:3000/api/v1/bookings/checkout-session/${tourId}`\r\n    );\r\n    await stripe.redirectToCheckout({\r\n      sessionId: session.data.session.id,\r\n    });\r\n  } catch (err) {\r\n    showAlert(\"error\", err);\r\n  }\r\n};\r\n"],"names":[],"version":3,"file":"bundle.js.map","sourceRoot":"../../"}